<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Music Streamer</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
        }
        .container {
            max-width: 800px;
        }
        .audio-card {
            background-color: #2d3748; /* Slightly lighter dark background for cards */
            border: 1px solid #4a5568;
        }
        .audio-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        audio {
            width: 100%;
            border-radius: 0.5rem; /* Rounded corners for audio player */
            background-color: #4a5568;
        }
    </style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-6 bg-gray-800 rounded-lg shadow-xl">
        <h1 class="text-4xl font-bold text-center mb-8 text-blue-400">Your Music Collection</h1>

        <div id="loading" class="text-center text-lg text-gray-400 mb-4">
            Loading music...
        </div>

        <div id="music-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Music items will be inserted here by JavaScript -->
        </div>

        <div id="no-music-found" class="hidden text-center text-lg text-gray-400 mt-8">
            No music files found. Please upload .mp3 or .wav files to your Cloudinary account.
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const musicListDiv = document.getElementById('music-list');
            const loadingDiv = document.getElementById('loading');
            const noMusicFoundDiv = document.getElementById('no-music-found');

            try {
                // Fetch music data from the serverless function
                // In a production environment, replace '/api/music' with your Vercel deployment URL if deploying to a different domain.
                const response = await fetch('/api/music');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const musicFiles = await response.json();

                if (musicFiles.length === 0) {
                    noMusicFoundDiv.classList.remove('hidden');
                } else {
                    musicFiles.forEach(file => {
                        // Create a card for each music file
                        const card = document.createElement('div');
                        card.className = 'audio-card p-4 rounded-lg shadow-md transition-transform duration-200 ease-in-out';

                        // Extract title from public_id (remove folder paths and extension)
                        const publicIdParts = file.public_id.split('/');
                        const fileName = publicIdParts[publicIdParts.length - 1];
                        const title = fileName.replace(/\.(mp3|wav)$/i, '').replace(/_/g, ' '); // Remove extension and replace underscores

                        const titleElement = document.createElement('h2');
                        titleElement.className = 'text-xl font-semibold mb-3 text-blue-300';
                        titleElement.textContent = title;

                        const audioElement = document.createElement('audio');
                        audioElement.setAttribute('controls', ''); // Show native audio controls
                        audioElement.setAttribute('src', file.secure_url);
                        audioElement.className = 'mt-2';

                        card.appendChild(titleElement);
                        card.appendChild(audioElement);
                        musicListDiv.appendChild(card);
                    });
                }
            } catch (error) {
                console.error('Error fetching music files:', error);
                musicListDiv.innerHTML = `<p class="text-red-400 text-center col-span-full">Failed to load music. Please check the console for details: ${error.message}</p>`;
            } finally {
                loadingDiv.classList.add('hidden'); // Hide loading indicator
            }
        });
    </script>
</body>
</html>

